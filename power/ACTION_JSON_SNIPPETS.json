{
  "ACTION_1_Create_Action_Item_Task": {
    "type": "OpenApiConnection",
    "inputs": {
      "host": {
        "connectionName": "shared_planner",
        "operationId": "CreateTask_V4",
        "apiId": "/providers/Microsoft.PowerApps/apis/shared_planner"
      },
      "parameters": {
        "groupId": "@variables('TeamID')",
        "planId": "@variables('PlanID')",
        "body/bucketId": "@variables('ActionItemsBucketID')",
        "body/title": "@items('Apply_to_each')?['title']",
        "body/assignments": {},
        "body/percentComplete": 0,
        "body/dueDateTime": "@addDays(utcNow(), items('Apply_to_each')?['dueInDays'])",
        "body/details": {
          "description": "@{items('Apply_to_each')?['description']}\n\nPriority: @{items('Apply_to_each')?['priority']}\nCategory: @{items('Apply_to_each')?['category']}\nProject: @{variables('ProjectTitle')}",
          "previewType": "description"
        }
      },
      "authentication": "@parameters('$authentication')"
    }
  },

  "ACTION_2_Set_Task_Priority": {
    "type": "OpenApiConnection",
    "inputs": {
      "host": {
        "connectionName": "shared_planner",
        "operationId": "UpdateTask_V3",
        "apiId": "/providers/Microsoft.PowerApps/apis/shared_planner"
      },
      "parameters": {
        "taskId": "@body('Create_Action_Item_Task')?['id']",
        "body/priority": "@if(equals(items('Apply_to_each')?['priority'], 'high'), 1, if(equals(items('Apply_to_each')?['priority'], 'medium'), 5, 9))"
      },
      "authentication": "@parameters('$authentication')",
      "headers": {
        "If-Match": "@body('Create_Action_Item_Task')?['@odata.etag']"
      }
    },
    "runAfter": {
      "Create_Action_Item_Task": [
        "Succeeded"
      ]
    }
  },

  "ACTION_3_Create_Missing_Info_Task": {
    "type": "OpenApiConnection",
    "inputs": {
      "host": {
        "connectionName": "shared_planner",
        "operationId": "CreateTask_V4",
        "apiId": "/providers/Microsoft.PowerApps/apis/shared_planner"
      },
      "parameters": {
        "groupId": "@variables('TeamID')",
        "planId": "@variables('PlanID')",
        "body/bucketId": "@variables('MissingInfoBucketID')",
        "body/title": "Gather: @{items('Apply_to_each_2')?['item']}",
        "body/assignments": {},
        "body/percentComplete": 0,
        "body/details": {
          "description": "Missing Information Item\n\nCategory: @{items('Apply_to_each_2')?['category']}\nPriority: @{items('Apply_to_each_2')?['priority']}\nProject: @{variables('ProjectTitle')}",
          "previewType": "description"
        }
      },
      "authentication": "@parameters('$authentication')"
    }
  },

  "ACTION_4_Set_Missing_Info_Priority": {
    "type": "OpenApiConnection",
    "inputs": {
      "host": {
        "connectionName": "shared_planner",
        "operationId": "UpdateTask_V3",
        "apiId": "/providers/Microsoft.PowerApps/apis/shared_planner"
      },
      "parameters": {
        "taskId": "@body('Create_Missing_Info_Task')?['id']",
        "body/priority": "@if(equals(items('Apply_to_each_2')?['priority'], 'high'), 1, if(equals(items('Apply_to_each_2')?['priority'], 'medium'), 5, 9))"
      },
      "authentication": "@parameters('$authentication')",
      "headers": {
        "If-Match": "@body('Create_Missing_Info_Task')?['@odata.etag']"
      }
    },
    "runAfter": {
      "Create_Missing_Info_Task": [
        "Succeeded"
      ]
    }
  }
}
